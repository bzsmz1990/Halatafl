var gameLogic;!function(a){function b(){return[["X","X","F","","F","X","X"],["X","X","","","","X","X"],["","","","","","",""],["S","S","S","S","S","S","S"],["S","S","S","S","S","S","S"],["X","X","S","S","S","X","X"],["X","X","S","S","S","X","X"]]}function c(a){var b,c,d=0;for(b=0;3>b;b++)for(c=2;5>c;c++)"S"===a[b][c]&&d++;if(9===d)return"S";for(d=0,b=0;7>b;b++)for(c=0;7>c;c++)if("S"===a[b][c]&&(d++,d>8))return"";return"F"}function d(a,b){var c=[];if(1===b){for(var d=0;7>d;d++)for(var f=0;7>f;f++)if("F"===a[d][f])for(var g=0;7>g;g++)for(var h=0;7>h;h++)try{c.push(e(a,d,f,g,h,b))}catch(i){}}else for(var d=0;7>d;d++)for(var f=0;7>f;f++)if("S"===a[d][f])for(var g=0;7>g;g++)for(var h=0;7>h;h++)try{c.push(e(a,d,f,g,h,b))}catch(i){}return c}function e(a,d,e,i,j,k){if(void 0===a&&(a=b()),""!==c(a))throw new Error("Can only make a move if the game is not over!");var l,m=!1;if(1===k){var n=f(a,d,e,i,j);l=n.boardAfterMove,m=n.isJump}else l=g(a,d,e,i,j);var o,p=c(l);if(""!==p)o={endMatch:{endMatchScores:"F"===p?[0,1]:[1,0]}};else if(1===k&&m&&h(l,i,j))o={setTurn:{turnIndex:k}};else if(0!==k||h(l,i,j))o={setTurn:{turnIndex:1-k}};else{var q,r,s,t,u=!1;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===a[s][t]){q=s,r=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(q+s>6||0>q+s||r+t>6||0>r+t||(q+r)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[q+s][r+t])){u=!0;break}if(!u){var v,w;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===a[s][t]&&(s!==q||t!==r)){v=s,w=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(v+s>6||0>v+s||w+t>6||0>w+t||(v+w)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[v+s][w+t])){u=!0;break}}console.log("not tie yet"),u?o={setTurn:{turnIndex:1-k}}:(o={endMatch:{endMatchScores:[0,0]}},console.log("is tie"))}return[o,{set:{key:"board",value:l}},{set:{key:"delta",value:{rowBefore:d,colBefore:e,rowAfter:i,colAfter:j}}}]}function f(a,b,c,d,e){if("F"!==a[b][c])throw new Error("Please move a fox");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");var f,g,h,i,j=!1,k=!1;for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((c+b)%2===0||0===f||0===g)&&(h=c+2*f,i=b+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+b)/2][(h+c)/2]&&(j=!0,d===i&&e===h&&(k=!0)));if(j===!0&&k===!1)throw new Error("Fox must jump over sheep if possible");if(j===!1){var l,m,n=!1;for(f=0;7>f;f++)for(g=0;7>g;g++)if("F"===a[f][g]&&(f!==b||g!==c)){l=f,m=g;break}for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((m+l)%2===0||0===f||0===g)&&(h=m+2*f,i=l+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+l)/2][(h+m)/2]&&(n=!0));if(n===!0)throw new Error("Should move the fox with jump possibility");if((c+b)%2===0&&(Math.abs(d-b)+Math.abs(e-c)>2||2===Math.abs(d-b)||2===Math.abs(e-c)))throw new Error("Fox must move to adjacent vertices");if((c+b)%2!==0&&Math.abs(d-b)+Math.abs(e-c)!==1)throw new Error("Fox must move to adjacent vertices")}var o=angular.copy(a);return o[d][e]="F",o[b][c]="",(2==Math.abs(d-b)||2==Math.abs(e-c))&&(o[(d+b)/2][(e+c)/2]=""),{boardAfterMove:o,isJump:k}}function g(a,b,c,d,e){if("S"!==a[b][c])throw new Error("Please move a sheep");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");if(d!==b&&d!==b-1||Math.abs(e-c)>1)throw new Error("Sheep must move to adjacent vertices and cannot back up");if(1==Math.abs(d-b)&&1==Math.abs(e-c))throw new Error("Sheep cannot move diagonally");var f=angular.copy(a);return f[d][e]="S",f[b][c]="",f}function h(a,b,c){var d,e,f,g,h,i,j=!1;for(d=b,e=c,f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((e+d)%2===0||0===f||0===g)&&(h=e+2*f,i=d+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+d)/2][(h+e)/2]&&(j=!0));return j}function i(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{{var f=b[2].set.value,g=f.rowBefore,h=f.colBefore,i=f.rowAfter,j=f.colAfter,k=d.board;e(k,g,h,i,j,c)}}catch(l){return!1}return!0}a.getInitialBoard=b,a.getPossibleMoves=d,a.createMove=e,a.isMoveOk=i}(gameLogic||(gameLogic={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).factory("gameLogic",function(){return{getInitialBoard:gameLogic.getInitialBoard,getPossibleMoves:gameLogic.getPossibleMoves,createMove:gameLogic.createMove,isMoveOk:gameLogic.isMoveOk}});var aiService;!function(a){function b(a,b){var i=gameLogic.getPossibleMoves(a,b);if(0===b&&0!==i.length){var j=i[Math.floor(Math.random()*i.length)];return j}var k;try{if(f)for(var l=0;l<i.length;l++)(i[l][2].set.value.rowBefore!==g||i[l][2].set.value.colBefore!==h)&&i.splice(l,1);if(1===i.length)k=i[0];else if(d(i[0])){var m=1;k=i[0];for(var l=0;l<i.length;l++){var n=1+c(i[l]);n>m&&(m=n,k=i[l])}}else{var m=0;k=i[0];for(var l=0;l<i.length;l++){var n=c(i[l]);n>m&&(m=n,k=i[l])}if(0===m){for(var o=0,l=0;l<i.length;l++){var n=e(i[l]);n>o&&(o=n,k=i[l])}if(0===o)if(i[0][2].set.value.rowBefore<3){for(var l=0;l<i.length;l++)if(i[l][2].set.value.rowBefore<i[l][2].set.value.rowAfter){k=i[l];break}}else for(var l=0;l<i.length;l++)if(i[l][2].set.value.rowBefore>i[l][2].set.value.rowAfter){k=i[l];break}}}}catch(p){k=i[0]}if(d(k)){var l,q=gameLogic.getPossibleMoves(k[1].set.value,1);for(l=0;l<q.length;l++)if(d(q[l])&&q[l][2].set.value.rowBefore===k[2].set.value.rowAfter&&q[l][2].set.value.colBefore===k[2].set.value.colAfter){f=!0,g=k[2].set.value.rowAfter,h=k[2].set.value.colAfter;break}console.log("i is "+l),l===q.length&&(f=!1)}else f=!1;return k}function c(a){for(var b=gameLogic.getPossibleMoves(a[1].set.value,1),e=0;e<b.length;e++)(b[e][2].set.value.rowBefore!==a[2].set.value.rowAfter||b[e][2].set.value.colBefore!==a[2].set.value.colAfter)&&b.splice(e,1);if(0===b.length)return 0;if(!d(b[0]))return 0;if(1===b.length&&d(b[0]))return 1;for(var f=0,a=b[0],e=0;e<b.length;e++){var g=c(b[e]);g>f&&(f=g,a=b[e])}return 1+f}function d(a){var b=a[2].set.value.rowBefore,c=a[2].set.value.rowAfter,d=a[2].set.value.colBefore,e=a[2].set.value.colAfter;return 2===Math.abs(b-c)||2===Math.abs(d-e)?!0:!1}function e(a){for(var b=a[2].set.value.rowAfter,c=a[2].set.value.colAfter,d=a[1].set.value,e=0,f=-1;2>f;f++)for(var g=-1;2>g;g++)(0!==f||0!==g)&&(0>b+f||b+f>6||0>c+g||c+g>6||"S"===d[b+f][c+g]&&(e++,console.log("count: ",b+f,c+g)));return e}var f=!1,g=0,h=0;a.createComputerMove=b}(aiService||(aiService={})),angular.module("myApp").factory("aiService",function(){return{createComputerMove:aiService.createComputerMove}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","$rootScope","gameLogic",function(a,b,c,d,e){"use strict";function f(){var b=p(a.board,a.turnIndex);gameService.makeMove(b)}function g(d){a.board=d.stateAfterMove.board,a.delta=d.stateAfterMove.delta;var g=!0;void 0===a.board&&(a.board=e.getInitialBoard(),g=!1,i()),a.isYourTurn=d.turnIndexAfterMove>=0&&d.yourPlayerIndex===d.turnIndexAfterMove,a.turnIndex=d.turnIndexAfterMove,g&&j(),a.isYourTurn&&""===d.playersInfo[d.yourPlayerIndex].playerId&&(a.isYourTurn=!1,a.computerMove=!0,b.info(a.computerMove),c(f,1200),c(h,1e3),b.info(a.computerMove))}function h(){a.computerMove=!1}function i(){a.uiState=[];var b,c,d={content:-1,isSelected:!1},f=e.getInitialBoard();for(b=0;7>b;b++)for(c=0;7>c;c++)if(0===c&&a.uiState.push([]),"F"===f[b][c]){var g=angular.copy(d);g.content=1,a.uiState[b][c]=g}else if("S"===f[b][c]){var h=angular.copy(d);h.content=0,a.uiState[b][c]=h}else a.uiState[b][c]=d;a.justInitialize=!0}function j(){for(var c=0;7>c;c++)for(var d=0;7>d;d++){var e=a.board[c][d],f=a.uiState[c][d],g={content:"S"===e?0:"F"===e?1:-1,isSelected:1===a.isSecondClick?f.isSelected:!1};a.uiState[c][d]=g}a.justInitialize=!1,a.isSecondClick=0,b.info(a.justHasRandomMove);var h=a.delta.rowAfter,i=a.delta.colAfter,j=document.getElementById("e2e_test_img_"+h+"x"+i);j.className="enlarge1"===j.className?"enlarge2":"enlarge1",b.info("current"+j.className);for(var c=(a.delta.rowBefore,a.delta.colBefore,0);7>c;c++)for(var d=0;7>d;d++)b.info(a.uiState[c][d].content);b.info("turnIndex "+a.turnIndex),b.info("current"+j.className)}function k(c,d,e){if(b.info(a.computerMove),a.computerMove!==!0){var f,g,h=d-t.offsetLeft,i=e-t.offsetTop;if(0>h||0>i||h>=t.clientWidth||i>=t.clientHeight){if(!x)return;var j=m();l({top:i-j.height/2,left:h-j.width/2})}else{var g=Math.floor(v*h/t.clientWidth),f=Math.floor(u*(i-.12*t.clientHeight)/t.clientHeight/.75);if("touchstart"!==c||w||(b.info("turnIndex "+a.turnIndex),(""!=a.board[f][g]||"X"!=a.board[f][g])&&(w={row:f,col:g},b.info("firstrow"+w.row),x=document.getElementById("e2e_test_img_"+f+"x"+g),b.info("draggingPiece"+x),x.style["z-index"]=++y,b.info("style"+x.style["z-index"]))),!x)return;if("touchend"===c){var k=w,p={row:f,col:g};0===a.turnIndex?(k.row>p.row&&(p.row=k.row-1),k.col<p.col&&(p.col=k.col+1),k.col>p.col&&(p.col=k.col-1)):(p.row===k.row&&p.col<k.col&&(p.col="S"===a.board[p.row][k.col-1]?k.col-2:k.col-1),p.row===k.row&&p.col>k.col&&(p.col="S"===a.board[p.row][k.col+1]?k.col+2:k.col+1),p.col===k.col&&p.row<k.row&&(p.row="S"===a.board[k.row-1][k.col]?k.row-2:k.row-1),p.col===k.col&&p.row>k.row&&(p.row="S"===a.board[k.row+1][k.col]?k.row+2:k.row+1),p.row<k.row&&p.col<k.col&&Math.abs(p.row-k.row)===Math.abs(p.col-k.col)&&("S"===a.board[k.row-1][k.col-1]?(p.row=k.row-2,p.col=k.col-2):(p.row=k.row-1,p.col=k.col-1)),p.row<k.row&&p.col>k.col&&Math.abs(p.row-k.row)===Math.abs(p.col-k.col)&&("S"===a.board[k.row-1][k.col+1]?(p.row=k.row-2,p.col=k.col+2):(p.row=k.row-1,p.col=k.col+1)),p.row>k.row&&p.col<k.col&&Math.abs(p.row-k.row)===Math.abs(p.col-k.col)&&("S"===a.board[k.row+1][k.col-1]?(p.row=k.row+2,p.col=k.col-2):(p.row=k.row+1,p.col=k.col-1)),p.row>k.row&&p.col>k.col&&Math.abs(p.row-k.row)===Math.abs(p.col-k.col)&&("S"===a.board[k.row+1][k.col+1]?(p.row=k.row+2,p.col=k.col+2):(p.row=k.row+1,p.col=k.col+1))),o(k,p)}else{var j=m();l({top:i-.12*t.clientHeight-j.height/2,left:h-j.width/2})}}("touchend"===c||"touchcancel"===c||"touchleave"===c)&&(l(n(w.row,w.col)),w=null,x=null)}}function l(a){var b=n(w.row,w.col);x.style.left=a.left-b.left+"px",x.style.top=a.top-b.top+"px"}function m(){return{width:t.clientWidth/v,height:.75*t.clientHeight/u}}function n(a,b){var c=m();return{top:a*c.height,left:b*c.width}}function o(c,f){d.$apply(function(){try{b.info("turnIndex "+a.turnIndex);var d=e.createMove(a.board,c.row,c.col,f.row,f.col,a.turnIndex);gameService.makeMove(d)}catch(g){return b.info(["Invalid move:",c.row,c.col,f.row,f.col]),b.info(w),void b.info(w)}})}function p(a,b){var c=e.getPossibleMoves(a,b);if(0===b&&0!==c.length){var d=c[Math.floor(Math.random()*c.length)];return d}var f;try{if(z)for(var g=0;g<c.length;g++)(c[g][2].set.value.rowBefore!==A||c[g][2].set.value.colBefore!==B)&&c.splice(g,1);if(1===c.length)f=c[0];else if(r(c[0])){var h=1;f=c[0];for(var g=0;g<c.length;g++){var i=1+q(c[g]);i>h&&(h=i,f=c[g])}}else{var h=0;f=c[0];for(var g=0;g<c.length;g++){var i=q(c[g]);i>h&&(h=i,f=c[g])}if(0===h){for(var j=0,g=0;g<c.length;g++){var i=s(c[g]);i>j&&(j=i,f=c[g])}if(0===j)if(c[0][2].set.value.rowBefore<3){for(var g=0;g<c.length;g++)if(c[g][2].set.value.rowBefore<c[g][2].set.value.rowAfter){f=c[g];break}}else for(var g=0;g<c.length;g++)if(c[g][2].set.value.rowBefore>c[g][2].set.value.rowAfter){f=c[g];break}}}}catch(k){f=c[0]}if(r(f)){var g,l=e.getPossibleMoves(f[1].set.value,1);for(g=0;g<l.length;g++)if(r(l[g])&&l[g][2].set.value.rowBefore===f[2].set.value.rowAfter&&l[g][2].set.value.colBefore===f[2].set.value.colAfter){z=!0,A=f[2].set.value.rowAfter,B=f[2].set.value.colAfter;break}console.log("i is "+g),g===l.length&&(z=!1)}else z=!1;return f}function q(a){for(var b=e.getPossibleMoves(a[1].set.value,1),c=0;c<b.length;c++)(b[c][2].set.value.rowBefore!==a[2].set.value.rowAfter||b[c][2].set.value.colBefore!==a[2].set.value.colAfter)&&b.splice(c,1);if(0===b.length)return 0;if(!r(b[0]))return 0;if(1===b.length&&r(b[0]))return 1;for(var d=0,a=b[0],c=0;c<b.length;c++){var f=q(b[c]);f>d&&(d=f,a=b[c])}return 1+d}function r(a){var b=a[2].set.value.rowBefore,c=a[2].set.value.rowAfter,d=a[2].set.value.colBefore,e=a[2].set.value.colAfter;return 2===Math.abs(b-c)||2===Math.abs(d-e)?!0:!1}function s(a){for(var b=a[2].set.value.rowAfter,c=a[2].set.value.colAfter,d=a[1].set.value,e=0,f=-1;2>f;f++)for(var g=-1;2>g;g++)(0!==f||0!==g)&&(0>b+f||b+f>6||0>c+g||c+g>6||"S"===d[b+f][c+g]&&(e++,console.log("count: ",b+f,c+g)));return e}resizeGameAreaService.setWidthToHeight(.666666667),a.randomMove,a.justHasRandomMove=!1,a.computerMove=!1,a.justInitialize=!1,a.isFirstClick=!0,a.isSecondClick=0,a.firstClickRow,a.firstClickCol,a.secondClickRow,a.secondClickCol,a.getSquare=function(b,c){return a.uiState[b][c]};var t=document.getElementById("gameArea");b.info("clientWidth"+t.clientWidth),b.info("clientHeight"+t.clientHeight);var u=7,v=7,w=null,x=null,y=61;dragAndDropService.addDragListener("gameArea",k),a.countArrivedSheep=function(){for(var b=0,c=0;3>c;c++)for(var d=2;5>d;d++)"S"===a.board[c][d]&&b++;return b},a.countEatenSheep=function(){for(var b=0,c=0;7>c;c++)for(var d=0;7>d;d++)"S"===a.board[c][d]&&b++;return 20-b};var z=!1,A=0,B=0;window.e2e_test_stateService=stateService,gameService.setGame({gameDeveloperEmail:"zangwz@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:e.isMoveOk,updateUI:g})}]);
//# sourceMappingURL=everything.min.js.map
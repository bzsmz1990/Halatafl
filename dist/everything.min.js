var gameLogic;!function(a){function b(){return[["X","X","F","","F","X","X"],["X","X","","","","X","X"],["","","","","","",""],["S","S","S","S","S","S","S"],["S","S","S","S","S","S","S"],["X","X","S","S","S","X","X"],["X","X","S","S","S","X","X"]]}function c(a){var b,c,d=0;for(b=0;3>b;b++)for(c=2;5>c;c++)"S"===a[b][c]&&d++;if(9===d)return"S";for(d=0,b=0;7>b;b++)for(c=0;7>c;c++)if("S"===a[b][c]&&(d++,d>8))return"";return"F"}function d(a,b){var c=[];if(1===b){for(var d=0;7>d;d++)for(var f=0;7>f;f++)if("F"===a[d][f])for(var g=0;7>g;g++)for(var h=0;7>h;h++)try{c.push(e(a,d,f,g,h,b))}catch(i){}}else for(var d=0;7>d;d++)for(var f=0;7>f;f++)if("S"===a[d][f])for(var g=0;7>g;g++)for(var h=0;7>h;h++)try{c.push(e(a,d,f,g,h,b))}catch(i){}return c}function e(a,d,e,i,j,k){if(void 0===a&&(a=b()),""!==c(a))throw new Error("Can only make a move if the game is not over!");var l,m=!1;if(1===k){var n=f(a,d,e,i,j);l=n.boardAfterMove,m=n.isJump}else l=g(a,d,e,i,j);var o,p=c(l);if(""!==p)o={endMatch:{endMatchScores:"F"===p?[0,1]:[1,0]}};else if(1===k&&m&&h(l,i,j))o={setTurn:{turnIndex:k}};else if(0!==k||h(l,i,j))o={setTurn:{turnIndex:1-k}};else{var q,r,s,t,u=!1;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===a[s][t]){q=s,r=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(q+s>6||0>q+s||r+t>6||0>r+t||(q+r)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[q+s][r+t])){u=!0;break}if(!u){var v,w;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===a[s][t]&&(s!==q||t!==r)){v=s,w=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(v+s>6||0>v+s||w+t>6||0>w+t||(v+w)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[v+s][w+t])){u=!0;break}}console.log("not tie yet"),u?o={setTurn:{turnIndex:1-k}}:(o={endMatch:{endMatchScores:[0,0]}},console.log("is tie"))}return[o,{set:{key:"board",value:l}},{set:{key:"delta",value:{rowBefore:d,colBefore:e,rowAfter:i,colAfter:j}}}]}function f(a,b,c,d,e){if("F"!==a[b][c])throw new Error("Please move a fox");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");var f,g,h,i,j=!1,k=!1;for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((c+b)%2===0||0===f||0===g)&&(h=c+2*f,i=b+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+b)/2][(h+c)/2]&&(j=!0,d===i&&e===h&&(k=!0)));if(j===!0&&k===!1)throw new Error("Fox must jump over sheep if possible");if(j===!1){var l,m,n=!1;for(f=0;7>f;f++)for(g=0;7>g;g++)if("F"===a[f][g]&&(f!==b||g!==c)){l=f,m=g;break}for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((m+l)%2===0||0===f||0===g)&&(h=m+2*f,i=l+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+l)/2][(h+m)/2]&&(n=!0));if(n===!0)throw new Error("Should move the fox with jump possibility");if((c+b)%2===0&&(Math.abs(d-b)+Math.abs(e-c)>2||2===Math.abs(d-b)||2===Math.abs(e-c)))throw new Error("Fox must move to adjacent vertices");if((c+b)%2!==0&&Math.abs(d-b)+Math.abs(e-c)!==1)throw new Error("Fox must move to adjacent vertices")}var o=angular.copy(a);return o[d][e]="F",o[b][c]="",(2==Math.abs(d-b)||2==Math.abs(e-c))&&(o[(d+b)/2][(e+c)/2]=""),{boardAfterMove:o,isJump:k}}function g(a,b,c,d,e){if("S"!==a[b][c])throw new Error("Please move a sheep");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");if(d!==b&&d!==b-1||Math.abs(e-c)>1)throw new Error("Sheep must move to adjacent vertices and cannot back up");if(1==Math.abs(d-b)&&1==Math.abs(e-c))throw new Error("Sheep cannot move diagonally");var f=angular.copy(a);return f[d][e]="S",f[b][c]="",f}function h(a,b,c){var d,e,f,g,h,i,j=!1;for(d=b,e=c,f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((e+d)%2===0||0===f||0===g)&&(h=e+2*f,i=d+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+d)/2][(h+e)/2]&&(j=!0));return j}function i(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{{var f=b[2].set.value,g=f.rowBefore,h=f.colBefore,i=f.rowAfter,j=f.colAfter,k=d.board;e(k,g,h,i,j,c)}}catch(l){return!1}return!0}a.getInitialBoard=b,a.getPossibleMoves=d,a.createMove=e,a.isMoveOk=i}(gameLogic||(gameLogic={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).factory("gameLogic",function(){return{getInitialBoard:gameLogic.getInitialBoard,getPossibleMoves:gameLogic.getPossibleMoves,createMove:gameLogic.createMove,isMoveOk:gameLogic.isMoveOk}});var aiService;!function(a){function b(a,b){var i=gameLogic.getPossibleMoves(a,b);if(0===b&&0!==i.length){var j=i[Math.floor(Math.random()*i.length)];return j}var k;try{if(f)for(var l=0;l<i.length;l++)(i[l][2].set.value.rowBefore!==g||i[l][2].set.value.colBefore!==h)&&i.splice(l,1);if(1===i.length)k=i[0];else if(d(i[0])){var m=1;k=i[0];for(var l=0;l<i.length;l++){var n=1+c(i[l]);n>m&&(m=n,k=i[l])}}else{var m=0;k=i[0];for(var l=0;l<i.length;l++){var n=c(i[l]);n>m&&(m=n,k=i[l])}if(0===m){for(var o=0,l=0;l<i.length;l++){var n=e(i[l]);n>o&&(o=n,k=i[l])}if(0===o)if(i[0][2].set.value.rowBefore<3){for(var l=0;l<i.length;l++)if(i[l][2].set.value.rowBefore<i[l][2].set.value.rowAfter){k=i[l];break}}else for(var l=0;l<i.length;l++)if(i[l][2].set.value.rowBefore>i[l][2].set.value.rowAfter){k=i[l];break}}}}catch(p){k=i[0]}if(d(k)){var l,q=gameLogic.getPossibleMoves(k[1].set.value,1);for(l=0;l<q.length;l++)if(d(q[l])&&q[l][2].set.value.rowBefore===k[2].set.value.rowAfter&&q[l][2].set.value.colBefore===k[2].set.value.colAfter){f=!0,g=k[2].set.value.rowAfter,h=k[2].set.value.colAfter;break}console.log("i is "+l),l===q.length&&(f=!1)}else f=!1;return k}function c(a){for(var b=gameLogic.getPossibleMoves(a[1].set.value,1),e=0;e<b.length;e++)(b[e][2].set.value.rowBefore!==a[2].set.value.rowAfter||b[e][2].set.value.colBefore!==a[2].set.value.colAfter)&&b.splice(e,1);if(0===b.length)return 0;if(!d(b[0]))return 0;if(1===b.length&&d(b[0]))return 1;for(var f=0,a=b[0],e=0;e<b.length;e++){var g=c(b[e]);g>f&&(f=g,a=b[e])}return 1+f}function d(a){var b=a[2].set.value.rowBefore,c=a[2].set.value.rowAfter,d=a[2].set.value.colBefore,e=a[2].set.value.colAfter;return 2===Math.abs(b-c)||2===Math.abs(d-e)?!0:!1}function e(a){for(var b=a[2].set.value.rowAfter,c=a[2].set.value.colAfter,d=a[1].set.value,e=0,f=-1;2>f;f++)for(var g=-1;2>g;g++)(0!==f||0!==g)&&(0>b+f||b+f>6||0>c+g||c+g>6||"S"===d[b+f][c+g]&&(e++,console.log("count: ",b+f,c+g)));return e}var f=!1,g=0,h=0;a.createComputerMove=b}(aiService||(aiService={})),angular.module("myApp").factory("aiService",function(){return{createComputerMove:aiService.createComputerMove}});var game;!function(a){function b(){resizeGameAreaService.setWidthToHeight(.666666667),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:e}),document.addEventListener("animationend",c,!1),document.addEventListener("webkitAnimationEnd",c,!1),document.addEventListener("oanimationend",c,!1),dragAndDropService.addDragListener("gameArea",j)}function c(){$rootScope.$apply(function(){log.info("Animation ended"),v=!0,x&&d()})}function d(){var a=o(z.board,s);gameService.makeMove(a)}function e(a){z=a.stateAfterMove;var b=!0;void 0===z.board&&(z.board=gameLogic.getInitialBoard(),b=!1,g()),t=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,s=a.turnIndexAfterMove,b&&h(),x=t&&""===a.playersInfo[a.yourPlayerIndex].playerId,x&&(t=!1,z.delta||(console.log(x),$timeout(d,1200),$timeout(f,1e3),console.log(x)))}function f(){x=!1}function g(){A=[];var a,b,c={content:-1,isSelected:!1},d=gameLogic.getInitialBoard();for(a=0;7>a;a++)for(b=0;7>b;b++)if(0===b&&A.push([]),"F"===d[a][b]){var e=angular.copy(c);e.content=1,A[a][b]=e}else if("S"===d[a][b]){var f=angular.copy(c);f.content=0,A[a][b]=f}else A[a][b]=c;G=!0}function h(){for(var a=0;7>a;a++)for(var b=0;7>b;b++){var c=z.board[a][b],d=A[a][b],e={content:"S"===c?0:"F"===c?1:-1,isSelected:1===y?d.isSelected:!1};A[a][b]=e}G=!1,y=0,console.log(w);var f=z.delta.rowAfter,g=z.delta.colAfter,h=document.getElementById("e2e_test_img_"+f+"x"+g);h.className="enlarge1"===h.className?"enlarge2":"enlarge1",console.log("current"+h.className);for(var a=(z.delta.rowBefore,z.delta.colBefore,0);7>a;a++)for(var b=0;7>b;b++)console.log(A[a][b].content);console.log("turnIndex "+s),console.log("current"+h.className)}function i(a,b){return A[a][b]}function j(a,b,c){if(u=document.getElementById("gameArea"),console.log("clientWidth"+u.clientWidth),console.log("clientHeight"+u.clientHeight),console.log(x),x!==!0){var d,e,f=b-u.offsetLeft,g=c-u.offsetTop;if(0>f||0>g||f>=u.clientWidth||g>=u.clientHeight){if(!F)return;var h=l();k({top:g-h.height/2,left:f-h.width/2})}else{var e=Math.floor(D*f/u.clientWidth),d=Math.floor(C*(g-.12*u.clientHeight)/u.clientHeight/.75);if("touchstart"===a&&E.row<0&&E.col<0&&(console.log("turnIndex "+s),(""!=z.board[d][e]||"X"!=z.board[d][e])&&(E={row:d,col:e},console.log("firstrow"+E.row),F=document.getElementById("e2e_test_img_"+d+"x"+e),console.log("draggingPiece"+F),F.style["z-index"]=++B,console.log("style"+F.style["z-index"]))),!F)return;if("touchend"===a){var i=E,j={row:d,col:e};0===s?(i.row>j.row&&(j.row=i.row-1),i.col<j.col&&(j.col=i.col+1),i.col>j.col&&(j.col=i.col-1)):(j.row===i.row&&j.col<i.col&&(j.col="S"===z.board[j.row][i.col-1]?i.col-2:i.col-1),j.row===i.row&&j.col>i.col&&(j.col="S"===z.board[j.row][i.col+1]?i.col+2:i.col+1),j.col===i.col&&j.row<i.row&&(j.row="S"===z.board[i.row-1][i.col]?i.row-2:i.row-1),j.col===i.col&&j.row>i.row&&(j.row="S"===z.board[i.row+1][i.col]?i.row+2:i.row+1),j.row<i.row&&j.col<i.col&&Math.abs(j.row-i.row)===Math.abs(j.col-i.col)&&("S"===z.board[i.row-1][i.col-1]?(j.row=i.row-2,j.col=i.col-2):(j.row=i.row-1,j.col=i.col-1)),j.row<i.row&&j.col>i.col&&Math.abs(j.row-i.row)===Math.abs(j.col-i.col)&&("S"===z.board[i.row-1][i.col+1]?(j.row=i.row-2,j.col=i.col+2):(j.row=i.row-1,j.col=i.col+1)),j.row>i.row&&j.col<i.col&&Math.abs(j.row-i.row)===Math.abs(j.col-i.col)&&("S"===z.board[i.row+1][i.col-1]?(j.row=i.row+2,j.col=i.col-2):(j.row=i.row+1,j.col=i.col-1)),j.row>i.row&&j.col>i.col&&Math.abs(j.row-i.row)===Math.abs(j.col-i.col)&&("S"===z.board[i.row+1][i.col+1]?(j.row=i.row+2,j.col=i.col+2):(j.row=i.row+1,j.col=i.col+1))),n(i,j)}else{var h=l();k({top:g-.12*u.clientHeight-h.height/2,left:f-h.width/2})}}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(k(m(E.row,E.col)),E={row:-1,col:-1},F=null)}}function k(a){var b=m(E.row,E.col);F.style.left=a.left-b.left+"px",F.style.top=a.top-b.top+"px"}function l(){return{width:u.clientWidth/D,height:.75*u.clientHeight/C}}function m(a,b){var c=l();return{top:a*c.height,left:b*c.width}}function n(a,b){try{console.log("turnIndex "+s);var c=gameLogic.createMove(z.board,a.row,a.col,b.row,b.col,s);gameService.makeMove(c)}catch(d){return console.log(["Invalid move:",a.row,a.col,b.row,b.col]),console.log(E),void console.log(E)}}function o(a,b){var c=gameLogic.getPossibleMoves(a,b);if(0===b&&0!==c.length){var d=c[Math.floor(Math.random()*c.length)];return d}var e;try{if(H)for(var f=0;f<c.length;f++)(c[f][2].set.value.rowBefore!==I||c[f][2].set.value.colBefore!==J)&&c.splice(f,1);if(1===c.length)e=c[0];else if(q(c[0])){var g=1;e=c[0];for(var f=0;f<c.length;f++){var h=1+p(c[f]);h>g&&(g=h,e=c[f])}}else{var g=0;e=c[0];for(var f=0;f<c.length;f++){var h=p(c[f]);h>g&&(g=h,e=c[f])}if(0===g){for(var i=0,f=0;f<c.length;f++){var h=r(c[f]);h>i&&(i=h,e=c[f])}if(0===i)if(c[0][2].set.value.rowBefore<3){for(var f=0;f<c.length;f++)if(c[f][2].set.value.rowBefore<c[f][2].set.value.rowAfter){e=c[f];break}}else for(var f=0;f<c.length;f++)if(c[f][2].set.value.rowBefore>c[f][2].set.value.rowAfter){e=c[f];break}}}}catch(j){e=c[0]}if(q(e)){var f,k=gameLogic.getPossibleMoves(e[1].set.value,1);for(f=0;f<k.length;f++)if(q(k[f])&&k[f][2].set.value.rowBefore===e[2].set.value.rowAfter&&k[f][2].set.value.colBefore===e[2].set.value.colAfter){H=!0,I=e[2].set.value.rowAfter,J=e[2].set.value.colAfter;break}console.log("i is "+f),f===k.length&&(H=!1)}else H=!1;return e}function p(a){for(var b=gameLogic.getPossibleMoves(a[1].set.value,1),c=0;c<b.length;c++)(b[c][2].set.value.rowBefore!==a[2].set.value.rowAfter||b[c][2].set.value.colBefore!==a[2].set.value.colAfter)&&b.splice(c,1);if(0===b.length)return 0;if(!q(b[0]))return 0;if(1===b.length&&q(b[0]))return 1;for(var d=0,a=b[0],c=0;c<b.length;c++){var e=p(b[c]);e>d&&(d=e,a=b[c])}return 1+d}function q(a){var b=a[2].set.value.rowBefore,c=a[2].set.value.rowAfter,d=a[2].set.value.colBefore,e=a[2].set.value.colAfter;return 2===Math.abs(b-c)||2===Math.abs(d-e)?!0:!1}function r(a){for(var b=a[2].set.value.rowAfter,c=a[2].set.value.colAfter,d=a[1].set.value,e=0,f=-1;2>f;f++)for(var g=-1;2>g;g++)(0!==f||0!==g)&&(0>b+f||b+f>6||0>c+g||c+g>6||"S"===d[b+f][c+g]&&(e++,console.log("count: ",b+f,c+g)));return e}var s,t,u,v=!1,w=!1,x=!1,y=0,z=null,A=[],B=61,C=7,D=7,E={row:-1,col:-1},F=null,G=!1;a.init=b,a.getSquare=i,a.handleDragEvent=j;var H=!1,I=0,J=0}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_HALATAFL:"Welcome to Halatafl!",RULES_SLIDE1:"Rules: The goal of sheep is to occupy the 3x3 paddock area, as is shown here. Sheep can move only sideways and forwards but not backwards.",RULES_SLIDE2:"The goal of wolves is to catch 12 sheep to prevent them from filling the paddock area. Wolves can move in any direction along the game board's grid lines.",RULES_SLIDE3:"To catch a sheep, wolves jump over them, one or more times. Wolves must jump if they can. Enjoy!",CLOSE:"Close"}),game.init()});
//# sourceMappingURL=everything.min.js.map